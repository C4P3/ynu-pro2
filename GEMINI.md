# GEMINI.md

## このドキュメントの更新方法
このドキュメントはプロジェクトの現状を反映している必要があります。コードベースに大きな変更（新しい主要機能の追加、アーキテクチャの変更など）が加えられた場合は、以下のプロンプトをAIアシスタントに与えることで、このドキュメントを更新してください。

```
GEMINI.mdが古いので、現在の実装状況を反映させたい。また、更新が必要なときに自身で更新をするようなプロンプトを含めたい。さらに、TODOを含めるようにしたい
```

---

## 概要
このプロジェクトは、Unityで開発されたタイピング探索ゲームです。プレイヤーはタイピングによってキャラクターを操作し、ステージを探索します。シングルプレイモードと、PlayFabを利用したマルチプレイモードが実装されています。

## ゲームプレイ
- **タイピング**: ローマ字入力によるタイピングで、様々なアクションを行います。
- **探索**: ステージを探索し、アイテムを発見したり、ギミックを解除したりします。
- **ア��テム**: ゲームを有利に進めるための様々なアイテムが存在します。（爆弾、酸素回復、毒、ロケット、スター、雷など）

## 主な機能
- **シングルプレイ**: 一人で遊ぶモードです。
- **マルチプレイ**: PlayFabとUnity Relay (Mirror) を利用したオンラインマルチプレイに対応しており、ルーム作成や自動マッチングが可能です。
- **ランキング**: PlayFab Leaderboardを利用したスコアランキング機能があります。トップ5と自身の周囲のランキングを動的に表示します。
- **チュートリアル**: ゲームの遊び方を学べるチュートリアルがあります。

## 技術スタック
- **ゲームエンジン**: Unity
- **ネットワーキング**: Mirror, Unity Relay
- **バックエンド**: PlayFab (認証, マッチメイキング, データストレージ, Leaderboard)
- **言語**: C#

## TODO
- [ ] **エラーハンドリング**: PlayFab API呼び出し部分のエラーハンドリングを強化し、ユーザーへのフィードバックを改善する。
- [ ] **テスト**: マルチプレイ部分の結合テストを拡充する。

---

## 主要なスクリプトと連携

### マルチプレイの処理フロー
このゲームのマルチプレイは、**PlayFab (Lobby, Matchmaking)** と **Unity Relay (Mirror)** を組み合わせて実現されています。
（中略）

### 主要スクリプト

- **`GameManager.cs`**:
    - **シングルプレイ**のゲーム全体の進行管理（酸素、生存時間、スコア、ゲームオーバー処理）を行うシングルトン。ゲームオーバー時に不要なUIを非表示にする責務も負う。

- **`GameManagerMulti.cs`**:
    - **マルチプレイ**のゲーム全体の進行管理を行う。`GameDataSync` と連携し、両プレイヤーの状態を同期する。

- **`PlayerController.cs`**:
    - プレイヤーの移動、状態（通常、移動中、タイピング中）を管理する。`TypingManager` のイベントに応じてアクションを実行する。

- **`TypingManager.cs`**:
    - タイピングのロジック（入力判定、UI表示）を管理する。タイピング完了時にイベントを発行し `PlayerController` に通知する。

- **`ItemManager.cs`**:
    - アイテムのデータベースと効果の発動を管理するシングルトン。

- **`LevelManager.cs`**:
    - ステージ（タイルマップ）の生成と管理を行う。

- **`PlayFabAuthManager.cs`**:
    - PlayFabへの匿名認証を管理するシングルトン。シーンをまたいで生存し、ログイン状態を外部に提供する役割も持つ。

- **`PlayFabLeaderboardManager.cs`**:
    - PlayFabのLeaderboardからランキング情報を取得し、UIに表示する責務を持つシングルトン。「トップ5」と「自身の周囲」のランキングをマージし、重複なく表示する。`RankingEntry`プレハブを動的に生成してリストを構築する。

- **`RankingEntry.cs`**:
    - ランキングの1行分のUI（順位、名前、スコア）を管理するコンポーネント。プレハブにアタッチして使用される。

- **`PlayFabMatchMakingManager.cs`**:
    - PlayFabを利用したマッチメイキング（ルーム作成、参加）を管理するシングルトン。`MyRelayNetworkManager` と連携する。

- **`MyRelayNetworkManager.cs`**:
    - Mirrorの`NetworkManager`を継承し、Unity Relay���ービスとの連携を担う。

- **`UIController.cs`**:
    - ゲーム全体のUI（CanvasGroup）の表示/非表示を管理し、画面遷移を実現する。`PlayFabAuthManager`のログイン状態に応じて、初回起動かシーン遷移による復帰かを判断し、表示するUIを切り替える。

- **`StartSceneBGMManager.cs`**:
    - `StartScene`のBGMを管理するシングルトン。シーンのロードを検知し、`StartScene`にいる場合のみBGMを再生する。

- **`Back2HomeButton.cs`**:
    - `GameScene`から`StartScene`へ戻るためのボタンロジック。`Time.timeScale`をリセットし、シーンを遷移させる。
